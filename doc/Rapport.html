<!DOCTYPE html>
<html>
<head>
<title>Rapport.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback";
	font-size: 14px;
	padding: 0 12px;
	line-height: 22px;
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}


body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	color: #4080D0;
	text-decoration: none;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

h1 code,
h2 code,
h3 code,
h4 code,
h5 code,
h6 code {
	font-size: inherit;
	line-height: auto;
}

a:hover {
	color: #4080D0;
	text-decoration: underline;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left: 5px solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 14px;
	line-height: 19px;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

.mac code {
	font-size: 12px;
	line-height: 18px;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

/** Theming */

.vscode-light,
.vscode-light pre code {
	color: rgb(30, 30, 30);
}

.vscode-dark,
.vscode-dark pre code {
	color: #DDD;
}

.vscode-high-contrast,
.vscode-high-contrast pre code {
	color: white;
}

.vscode-light code {
	color: #A31515;
}

.vscode-dark code {
	color: #D7BA7D;
}

.vscode-light pre:not(.hljs),
.vscode-light code > div {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre:not(.hljs),
.vscode-dark code > div {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre:not(.hljs),
.vscode-high-contrast code > div {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

.vscode-light blockquote,
.vscode-dark blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.vscode-high-contrast blockquote {
	background: transparent;
	border-color: #fff;
}
</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

</style>

</head>
<body>
<h1 id="rapport-os-from-scratch">Rapport OS From Scratch</h1>
<ul>
<li><a href="#rapport-os-from-scratch">Rapport OS From Scratch</a>
<ul>
<li><a href="#1-introduction">1. Introduction</a></li>
<li><a href="#2-prerequis">2. Prérequis</a>
<ul>
<li><a href="#21-machine-virtuelle">2.1. Machine virtuelle</a></li>
<li><a href="#22-qemu">2.2. Qemu</a></li>
<li><a href="#23-nasm">2.3. Nasm</a></li>
<li><a href="#24-environnement">2.4 Environnement</a></li>
</ul>
</li>
<li><a href="#3-etape-du-projet">3 Etape du projet</a></li>
<li><a href="#4-bootloader-done">4. Bootloader (DONE)</a></li>
<li><a href="#4-crosscompiler">4. Crosscompiler</a>
<ul>
<li><a href="#41-implementer-le-cross-compiler">4.1 Implémenter le cross-compiler</a></li>
</ul>
</li>
<li><a href="#5-kernel">5. Kernel</a></li>
<li><a href="#6-problemes-rencontres">6. Problèmes rencontrés</a>
<ul>
<li><a href="#61-destruction-dune-machine-virtuelle">6.1. Destruction d'une machine virtuelle</a></li>
<li><a href="#62-installation-du-cross-compiler">6.2. Installation du cross-compiler</a></li>
</ul>
</li>
<li><a href="#mode-demploie">Mode d'emploie</a>
<ul>
<li><a href="#nasm">Nasm</a></li>
<li><a href="#qemu">QEmu</a></li>
</ul>
</li>
<li><a href="#7-conclusion">7. Conclusion</a></li>
<li><a href="#reference">Référence</a></li>
</ul>
</li>
</ul>
<h2 id="1-introduction">1. Introduction</h2>
<p>Nous employons tous un système d'éxploitation (ou au moins avons employé une fois) surtout dans notre travaille d'ingénieur en informatique. En effet, nous avons créé déjà des programmes qui sont exécuté sur des OS (Windows, Linux).
Dans le cours de conception OS nous avons choisi un projet qui consiste
à créer notre propre OS tournant sur une machine virtuel QEMU (émulateur d'architecture processeur). Avec ce projet nous voulons donc mieux comprendre comment fonctionne du côté hardware qu'au côté software notre OS, notamment les points suivant :</p>
<ul>
<li>Comment boot un ordinateur</li>
<li>Comment écrire des programes bas niveau alors qu'il n'y a pas encore d'OS</li>
<li>Comment relier le CPU avec tous les composants</li>
<li>Comment passer du code assembleur à un langage haut niveau.</li>
<li>Comment créer des caractéristique d'un OS comme un filesystem, un shell, des drivers, des tâches</li>
</ul>
<h2 id="2-pr%C3%A9requis">2. Prérequis</h2>
<h3 id="21-machine-virtuelle">2.1. Machine virtuelle</h3>
<p>Les différents collaborateurs du projets ont décidés de travailler sur une machine virtuel linux.</p>
<h3 id="22-qemu">2.2. Qemu</h3>
<p>Qemu est un logiciel qui permet de créer une machine virtuel permetant de simuler une architecture sur laquelle nous pouvons instancier notre os.
Nous émulons un processeur i386 comme architécture.</p>
<h3 id="23-nasm">2.3. Nasm</h3>
<p>Nasm est un compilateur qui permet notamment de transformer nos fichiers assembleurs  en fichiers binaire.</p>
<h3 id="24-environnement">2.4 Environnement</h3>
<p>Le projet a été réaliser sur une système UNIX plus précisement une distribution Ubuntu. Mais le projet peut se faire également sur un système MSDOS.</p>
<h2 id="3-etape-du-projet">3 Etape du projet</h2>
<ul>
<li>Crée un boot loader.</li>
<li>Entrer dans un mode 32-bit.</li>
<li>Pouvoir passer du langage bas niveau (assembleur) au haut niveau (exemple langaege c).</li>
<li>Gestion des I/O comme l'écran et le clavier.</li>
<li>Associer un libc pour avoir des commandes de bases (par exemple utiliser BusyBox).</li>
<li>Le MM (Memory Management).</li>
<li>Créer un système de fichier (filesystem)</li>
<li>Créer un shell de commande.</li>
</ul>
<h2 id="4-bootloader-done">4. Bootloader (DONE)</h2>
<p>Le bootloader est le programme qui sera lancé une fois que le BIOS à finit de s'initialiser.</p>
<p>Le Bios ne sait pas comment lancer l'OS, c'est le boot sector qui s'en occupe. Il est placé dans le 1er secteur du disque dr (cylindre 0, head 0, secteur 0). Il prend 512 bytes.
Ce boot sector est en 16-bit.
Dans un cas ou nous n'utiliserions pas une architecture virtuelle mais directement initialiser l'os sur un disque physique, il faudrait enregistrer le bootloader dans la MBR (Master Boot Record).</p>
<p>Avant l'initialisation</p>
<h2 id="4-crosscompiler">4. Crosscompiler</h2>
<h3 id="41-impl%C3%A9menter-le-cross-compiler">4.1 Implémenter le cross-compiler</h3>
<p>Tout d'abord nous alons récupérer le path de la version actuelle de gcc, avec la commande suivante :</p>
<pre class="hljs"><code><div><span class="hljs-built_in">which</span> gcc
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-built_in">export</span> CC=/usr/bin/gcc-4.9
<span class="hljs-built_in">export</span> LD=/usr/bin/gcc-4.9

<span class="hljs-built_in">export</span> PREFIX=<span class="hljs-string">"/usr/local/i386elfgcc"</span>
<span class="hljs-built_in">export</span> TARGET=i386-elf
<span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$PREFIX</span>/bin:<span class="hljs-variable">$PATH</span>"</span>
</div></code></pre>
<pre class="hljs"><code><div>mkdir /tmp/src
<span class="hljs-built_in">cd</span> /tmp/src
curl -O http://ftp.gnu.org/gnu/binutils/binutils-2.24.tar.gz
tar xf binutils-2.24.tar.gz
mkdir binutils-build
<span class="hljs-built_in">cd</span> binutils-build
../binutils-2.24/configure --target=<span class="hljs-variable">$TARGET</span> --<span class="hljs-built_in">enable</span>-interwork --<span class="hljs-built_in">enable</span>-multilib --<span class="hljs-built_in">disable</span>-nls --<span class="hljs-built_in">disable</span>-werror --prefix=<span class="hljs-variable">$PREFIX</span> 2&gt;&amp;1 | tee configure.log
make all install 2&gt;&amp;1 | tee make.log
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> /tmp/src
curl -O https://ftp.gnu.org/gnu/gcc/gcc-4.9.2/gcc-4.9.2.tar.bz2
tar xf gcc-4.9.2.tar.bz2
mkdir gcc-build
<span class="hljs-built_in">cd</span> gcc-build
../gcc-4.9.2/configure --target=<span class="hljs-variable">$TARGET</span> --prefix=<span class="hljs-string">"<span class="hljs-variable">$PREFIX</span>"</span> --<span class="hljs-built_in">disable</span>-nls --<span class="hljs-built_in">disable</span>-libssp --<span class="hljs-built_in">enable</span>-languages=c --without-headers
</div></code></pre>
<p>A noter qu'un script est disponible (gcc-4.9.x/contrib/download_prerequisites) pour télécharger les dépendances + créer les symlink automatiquement :
Dans le dossier source :</p>
<pre class="hljs"><code><div>./contrib/download_prerequisites
</div></code></pre>
<pre class="hljs"><code><div>make all-gcc
make all-target-libgcc
make install-gcc
make install-target-libgcc
</div></code></pre>
<p>make install-gcc peut demander de passer en root (?)</p>
<h2 id="5-kernel">5. Kernel</h2>
<h2 id="6-probl%C3%A8mes-rencontr%C3%A9s">6. Problèmes rencontrés</h2>
<h3 id="61-destruction-dune-machine-virtuelle">6.1. Destruction d'une machine virtuelle</h3>
<p>Bien que l'erreur n'est pas réellement lié au projet, nous tenions à rendre hommage à l'un des collaborateurs du projet qui en voulant éffacer un dans un dossier c'est un peu précipité et à tapé la ligne suivante :</p>
<pre class="hljs"><code><div>rm -rf /*
</div></code></pre>
<p>Nous vous laissons imaginer la suite.</p>
<h3 id="62-installation-du-cross-compiler">6.2. Installation du cross-compiler</h3>
<h2 id="mode-demploie">Mode d'emploie</h2>
<h3 id="nasm">Nasm</h3>
<p>Pour passer du code assembleur à du code brute :</p>
<pre class="hljs"><code><div><span class="hljs-variable">$nasm</span> boot_sect.asm -f -o boot_sect.bin
</div></code></pre>
<h3 id="qemu">QEmu</h3>
<p>Pour émuler notre os.</p>
<pre class="hljs"><code><div><span class="hljs-variable">$qemu</span> your-os-boot-disk-image-file.bin
</div></code></pre>
<h2 id="7-conclusion">7. Conclusion</h2>
<h2 id="r%C3%A9f%C3%A9rence">Référence</h2>
<ul>
<li><a href="http://www.cs.bham.ac.uk/~exr/lectures/opsys/10_11/lectures/os-dev.pdf">Writing a Simple Operation System - from Scratch</a> Document by Nick Blunde</li>
<li><a href="https://github.com/cfenollosa/os-tutorial">os-tutorial</a> Github by Carlos Fenollosa</li>
<li><a href="https://wiki.osdev.org/">wiki.osdev.org</a> - Wiki for creation of operation system</li>
</ul>

</body>
</html>
